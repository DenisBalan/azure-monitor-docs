---
title: Monitor Azure virtual machines with Azure Monitor - Workloads
description: Describes how to monitor the guest workloads of virtual machines in Azure Monitor.
ms.service:  azure-monitor
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 05/26/2021

---

# Monitoring virtual machines with Azure Monitor - Workloads
This article is part of the [Monitoring virtual machines and their workloads in Azure Monitor](monitor-virtual-machine.md). It describes how to monitor workloads that are running on the guest operating systems of your virtual machines. It provides details on analyzing and alerting on different sources of data on your virtual machines.

The requirements for data that you should collect and alerts that you should create depend on your particular applications. These are data sources commonly used by management packs in System Center Operations Manager which you may already be using for monitoring your applications. See [Converting management packs](monitor-virtual-machine-scom.md) for a strategy on converting management pack logic in Azure Monitor using the details in this article.


## Windows or Syslog event
Windows events or Syslog events on Linux computers generated by your application or the guest operating system. You can create an alert when a Windows or Syslog event is created. You can alert as soon as a single event is found or wait for a series of matching events within a particular time window.

### Data collection
Configure Log Analytics workspace to collect [Windows events](../agents/data-sources-windows-events.md) or [Syslog events](../agents/data-sources-windows-events.md). There is a cost associated with this data collection.

### Tables

| Table | Description |
|:---|:---|
| [Event](/azure/azure-monitor/reference/tables/event) | Windows events |
| [Syslog](/azure/azure-monitor/reference/tables/syslog) | Syslog events |

### Sample log queries

```kusto
//Count the number of events by computer event log, and event type
Event
| summarize count() by Computer, EventLog, EventLevelName
| sort by Computer, EventLog, EventLevelName
```

```kusto
//Count the number of events by computer event log, and event ID
Event
| summarize count() by Computer, EventLog, EventLevelName
| sort by Computer, EventLog, EventLevelName
```


### Sample alert rules
The following sample creates an alert when a specific Windows event is created. It uses a metric measurement alert rule to create a separate alert for each computer.


| Property | Value| Notes |
|:---|:---|:---|
| Name | Server Virtual Disk Redundancy Lost - System Event 2123 ||
| Scope | Log Analytics Workspace ||
| Signal Type | Logs ||
| Signal Name | Custom Log Search ||
| Search Query | `Event | where EventID == 123 | summarize AggregatedValue = count() by Computer, bin(TimeGenerated, 15m)`| Change to a query using `Syslog` table for Syslog alert. |
| Based on | Metric measurement | Ensures a separate alert for each machine. |
| Threshold | Greater than 0 | |
| Trigger | Breaches greater than 0 | Increase this value to require multiple consecutive events.  |
| Period | 15 | Defines the time window for the events that are processed. For example, if you want to look for a number of events with an hour, set the Period to 60 minutes. The query will only consider the events created over the previous hour. You should use this value rather than setting a time window in your query. |
| Frequency | 15 minutes | Change this value to run the alert rule more frequently with an increase in cost. | 


## Text logs
Events written to a text log stored on the virtual machine. 

### Data collection
Define a [custom log](../agents/data-sources-custom-logs.md) in the Log Analytics workspace. You define the location of the text log and its detailed configuration. There is a cost associated with this data collection.


### Tables

| Table | Description |
|:---|:---|
| MyTable_CL | Define the name and properties of the log when you configure it. |

### Sample alert rule


## IIS logs
Events logged by IIS on the virtual machine.

### Data collection
Enable IIS log collection on the workspace.

### Sample alert rule



## Service or deamon down
Alert when a Windows service or a Linux daemon stops. The recommended method to alert on service up/down is the [Change Tracking solution](../automation/change-tracking/overview.md).  Azure Monitor alone doesn’t have a means to alert when a service is down. There are some possible methods such as looking for events in the Windows event log, but this is unreliable. You could also look for the process associated with the service running on the machine from the [VMProcess](/azure/azure-monitor/reference/tables/vmprocess) table, but this only updated every hour which is not typically sufficient for alerting.

### Tables

| Table | Description |
|:---|:---|
| [ConfigurationChange](/azure/azure-monitor/reference/tables/configurationdata) | Changes to in-guest configuration data. |
| [ConfigurationData](/azure/azure-monitor/reference/tables/configurationdata) | Last reported state for in-guest configuration data. |

### Alert rule samples

**Alert when a specific service stops**


```kusto
ConfigurationData
| where SvcName == "W3SVC" 
| where SvcState == "Stopped"
| where ConfigDataType == "WindowsServices"
| where SvcStartupType == "Auto"
| summarize AggregatedValue = count() by Computer, SvcName, SvcDisplayName, SvcState, bin(TimeGenerated, 15m)
```

**Alert when one of a set of services stops**


```kusto
let services = dynamic(["omskd","cshost","schedule","wuauserv","heathservice","efs","wsusservice","SrmSvc","CertSvc","wmsvc","vpxd","winmgmt","netman","smsexec","w3svc","sms_site_vss_writer","ccmexe","spooler","eventsystem","netlogon","kdc","ntds","lsmserv","gpsvc","dns","dfsr","dfs","dhcp","DNSCache","dmserver","messenger","w32time","plugplay","rpcss","lanmanserver","lmhosts","eventlog","lanmanworkstation","wnirm","mpssvc","dhcpserver","VSS","ClusSvc","MSExchangeTransport","MSExchangeIS"]);
ConfigurationData
| where ConfigDataType == "WindowsServices"
| where SvcStartupType == "Auto"
| where SvcName in (services)
| where SvcState == "Stopped"
| project TimeGenerated, Computer, SvcName, SvcDisplayName, SvcState
| summarize AggregatedValue = count() by Computer, SvcName, SvcDisplayName, SvcState, bin(TimeGenerated, 15m)
```



## Port monitoring
Port monitoring verifies that a machine is listening on a particular port. 

## Data collection
There are two potential strategies for port monitoring. 

## Tables

| Table | Description |
|:---|:---|
| [VMBoundPort](/azure/azure-monitor/reference/tables/vmbounport) | Traffic for open server ports on the monitored machine. |
| [ConfigurationData](/azure/azure-monitor/reference/tables/configurationdata) | Last reported state for in-guest configuration data. |




## Custom performance counters



## Synthetic transactions
A synthetic transaction connects to an application or service running on the VM simulating a user connection or actual user traffic. If the application is available, then you can assume that the machine is running properly . Application monitoring is provided by Application insights 
This only works for applications that are accessible from the internet. For internal applications, you must open a firewall to allow access from specific Microsoft URLs performing the test, or use an alternate monitoring solution such as SCOM.

[URL test](../app/monitor-web-app-availability.md) – Ensures that HTTP is available and returning a web page.
[Multistep test](../app/availability-multistep.md) – Simulates a user session.



## Next steps

* [Learn how to analyze data in Azure Monitor logs using log queries.](../logs/get-started-queries.md)
* [Learn about alerts using metrics and logs in Azure Monitor.](../alerts/alerts-overview.md)