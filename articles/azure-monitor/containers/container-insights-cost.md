---
title: Monitoring cost for Container insights | Microsoft Docs
description: This article describes the monitoring cost for metrics and inventory data collected by Container insights to help customers manage their usage and associated costs. 
ms.topic: conceptual
ms.date: 03/02/2023
ms.reviewer: viviandiec
---

# Understand monitoring costs for Container insights

This article provides guidance for Container insights to help you understand your costs for Container insights after it's been enabled for one or more containers and how to filter data that you don't require and edit your collection settings to reduce your overall costs.

## Data collected by Container insights
The following table describes each of the tables stored in the Log Analytics workspace for Container insights.

| Table | Details | 
|:---|:---|
| ContainerLog | Contains stdout and stderr logs from each monitored cluster. |
| KubePodInventory | – 1 per pod per minute |
| KubeNodeInventory | – 1 per node per minute |
| ContainerInventory | – 1 per container per minute |
| KubeServices | – 1 per service per minute |


The following types of data collected from a Kubernetes cluster with Container insights influence cost and can be customized based on your usage:

- Perf, Inventory, InsightsMetrics, and KubeEvents can be controlled through [cost optimization settings](../containers/container-insights-cost-config.md)
- Stdout and stderr container logs from every monitored container in every Kubernetes namespace in the cluster via the [agent ConfigMap](../containers/container-insights-data-collection-configmap.md)
- Container environment variables from every monitored container in the cluster
- Completed Kubernetes jobs/pods in the cluster that don't require monitoring
- Active scraping of Prometheus metrics
- [Resource log collection](../../aks/monitor-aks.md#aks-control-planeresource-logs) of Kubernetes main node logs in your Azure Kubernetes Service (AKS) cluster to analyze log data generated by main components, such as `kube-apiserver` and `kube-controller-manager`.


### Analyzing your data ingestion

You can visualize how much data is ingested in each workspace by using the **Data Usage** runbook. The runbook is available from the **Reports** tab. 

:::image type="content" source="media/container-insights-cost/workbooks-dropdown.png" lightbox="media/container-insights-cost/workbooks-dropdown.png" alt-text="Screenshot that shows the View Workbooks dropdown list.":::

Navigate to the **By Table** section of the **Data Usage** workbook to see the breakdown of table sizes for Container Insights. This information will help you identify which tables are consuming the most data and help you make informed decisions about how to reduce costs.

:::image type="content" source="media/container-insights-cost/data-usage-workbook-by-table.png" lightbox="media/container-insights-cost/data-usage-workbook-by-table.png" alt-text="Screenshot that shows the By Table breakdown in Data Usage workbook.":::


## Filtering options
There are two methods that you can use to filter data being collected in Container insights. Depending on the filtering that you want to implement, you may be able to choose between the two methods or you may be required to use one or the other.

| Method | Description |
|:---|:---|
| ConfigMap | [ConfigMaps](https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/) are a Kubernetes mechanism that allow you to store non-confidential data such as a configuration file or environment variables. Container insights looks for a ConfigMap on each cluster with particular settings that define data that it should collect. |
| Data collection rule (DCR) | [Data collection rules](../monitoring-overview.md) are sets of instructions supporting data collection using the [Azure Monitor pipeline](../essentials/pipeline-overview.md). A DCR is created when you enable Container insights, and you can modify the settings in this DCR either using the Azure portal or other methods. |

## Container logs
Depending on the [log schema](container-insights-logs-schema.md) you have configured for your cluster, stdout and stderr logs will be collected in either [ContainerLog](/azure/azure-monitor/reference/tables/containerlog) or [ContainerLogV2](/azure/azure-monitor/reference/tables/containerlogv2). You can filter container logs using either ConfigMap or DCR. 

### ConfigMap

 - Use `[log_collection_settings]` in ConfigMap to either disable collection of stdout/stderr logs or exclude specific namespaces from collection.<br>- Use data collection rule (DCR) to exclude specific tables from collection. |



The following examples show what changes you can apply to your cluster by modifying the ConfigMap file to help control cost.

1. Disable stdout logs across all namespaces in the cluster by modifying the following code in the ConfigMap file for the Azure Container insights service that's pulling the metrics:

    ```
    [log_collection_settings]       
       [log_collection_settings.stdout]          
          enabled = false
    ```

1. Disable collecting stderr logs from your development namespace. An example is `dev-test`. Continue collecting stderr logs from other namespaces, such as, `prod` and `default`, by modifying the following code in the ConfigMap file:

    >[!NOTE]
    >The kube-system log collection is disabled by default. The default setting is retained. Adding the `dev-test` namespace to the list of exclusion namespaces is applied to stderr log collection.

    ```
    [log_collection_settings.stderr]          
       enabled = true          
          exclude_namespaces = ["kube-system", "dev-test"]
    ```

1. Disable environment variable collection across the cluster by modifying the following code in the ConfigMap file. This modification applies to all containers in every Kubernetes namespace.

    ```
    [log_collection_settings.env_var]
        enabled = false
    ```



After you apply one or more of these changes to your ConfigMaps, apply it to your cluster with the command `kubectl apply -f <config3. map_yaml_file.yaml>`. For example, run the command `kubectl apply -f container-azm-ms-agentconfig.yaml` to open the file in your default editor to modify and then save it.

### DCR



### Configure Basic Logs
[Basic Logs in Azure Monitor](../logs/basic-logs-configure.md) offer a significant cost discount for ingestion of data in your Log Analytics workspace for data that 

You can save on data ingestion costs on ContainerLog in your Log Analytics workspace that you primarily use for debugging, troubleshooting, and auditing as Basic Logs. For more information, including the limitations of Basic Logs, see [Configure Basic Logs in Azure Monitor](../logs/basic-logs-configure.md). ContainerLogV2 is the configured version of Basic Logs that Container Insights uses. ContainerLogV2 includes verbose text-based log records.

You must be on the ContainerLogV2 schema to configure Basic Logs. For more information, see [Enable the ContainerLogV2 schema (preview)](container-insights-logs-schema.md).


## Transformations
[Ingestion time transformations](../essentials/data-collection-transformations.md) allow you to apply a KQL query to filter and transform data in the [Azure Monitor pipeline](../essentials/pipeline-overview.md) before it's stored in the Log Analytics workspace. Add a transformation to the DCR created by Container insights to perform any additional filtering that you cannot perform with the options described above. This includes filtering data using more detailed logic, removing columns in the data that you don't require, or even sending data to multiple tables. 

See [Data transformations in Container insights](./container-insights-transformations.md)


## Next steps

To help you understand what the costs are likely to be based on recent usage patterns from data collected with Container insights, see [Analyze usage in a Log Analytics workspace](../logs/analyze-usage.md).
